---
title: another test
author: Jonathan Regenstein
date: '2017-08-10'
slug: another-test
categories: []
tags: []
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<script src="/rmarkdown-libs/proj4js/proj4.js"></script>
<link href="/rmarkdown-libs/highcharts/css/motion.css" rel="stylesheet" />
<script src="/rmarkdown-libs/highcharts/highstock.js"></script>
<script src="/rmarkdown-libs/highcharts/highcharts-3d.js"></script>
<script src="/rmarkdown-libs/highcharts/highcharts-more.js"></script>
<script src="/rmarkdown-libs/highcharts/modules/annotations.js"></script>
<script src="/rmarkdown-libs/highcharts/modules/broken-axis.js"></script>
<script src="/rmarkdown-libs/highcharts/modules/data.js"></script>
<script src="/rmarkdown-libs/highcharts/modules/drilldown.js"></script>
<script src="/rmarkdown-libs/highcharts/modules/exporting.js"></script>
<script src="/rmarkdown-libs/highcharts/modules/funnel.js"></script>
<script src="/rmarkdown-libs/highcharts/modules/heatmap.js"></script>
<script src="/rmarkdown-libs/highcharts/modules/map.js"></script>
<script src="/rmarkdown-libs/highcharts/modules/no-data-to-display.js"></script>
<script src="/rmarkdown-libs/highcharts/modules/offline-exporting.js"></script>
<script src="/rmarkdown-libs/highcharts/modules/solid-gauge.js"></script>
<script src="/rmarkdown-libs/highcharts/modules/treemap.js"></script>
<script src="/rmarkdown-libs/highcharts/plugins/annotations.js"></script>
<script src="/rmarkdown-libs/highcharts/plugins/draggable-legend.js"></script>
<script src="/rmarkdown-libs/highcharts/plugins/draggable-points.js"></script>
<script src="/rmarkdown-libs/highcharts/plugins/export-csv.js"></script>
<script src="/rmarkdown-libs/highcharts/plugins/grouped-categories.js"></script>
<script src="/rmarkdown-libs/highcharts/plugins/motion.js"></script>
<script src="/rmarkdown-libs/highcharts/plugins/pattern-fill-v2.js"></script>
<script src="/rmarkdown-libs/highcharts/plugins/tooltip-delay.js"></script>
<script src="/rmarkdown-libs/highcharts/custom/reset.js"></script>
<script src="/rmarkdown-libs/highcharts/custom/symbols-extra.js"></script>
<script src="/rmarkdown-libs/highcharts/custom/text-symbols.js"></script>
<link href="/rmarkdown-libs/fontawesome/font-awesome.min.css" rel="stylesheet" />
<link href="/rmarkdown-libs/htmlwdgtgrid/htmlwdgtgrid.css" rel="stylesheet" />
<script src="/rmarkdown-libs/highchart-binding/highchart.js"></script>


<iframe src="https://jkr216.shinyapps.io/Sharpe-Ratio-Flex/" width="100%" ; height="700">
</iframe>
<p>This is the third post in our series on portfolio volatility, variance and standard deviation. If you want to start at the beginning with calculating portfolio volatility, have a look at the first post <a href="https://rviews.rstudio.com/2017/07/12/introduction-to-volatility/">here - Intro to Volatility</a>. The second post on calculating rolling standard deviations is <a href="url">here: Intro to Rolling Volatility</a>.</p>
<p>Today we will visualize rolling standard deviations with <code>highcharter</code> using two objects from that second post.</p>
<p>The charts, which are the fun payoff after all of the equations and functions that we have ground out in the previous posts, should highlight any unusual occurrences or volatility spikes/dips that we might want to investigate.</p>
<p>First, load the <code>.RDat</code> file saved from our previous Notebook (or you can run the scripts from the previous posts).</p>
<pre class="r"><code>load(&#39;rolling-sd.RDat&#39;)</code></pre>
<p>We now have 2 objects in our Global Environment - <code>spy_rolling_sd</code> - an <code>xts</code> object of rolling SPY standard deviations - <code>roll_portfolio_result</code> - an <code>xts</code> object of rolling portfolio standard deviations. Because both of those are <code>xts</code> objects, we can pass them straight to <code>highcharter</code> with the <code>hc_add_series()</code> function and set a name and a color with the <code>name</code> and <code>color</code> arguments. Nothing too complicated here - we did the hard work in our previous Notebooks.</p>
<pre class="r"><code>highchart(type = &quot;stock&quot;) %&gt;%
  hc_title(text = &quot;SPY v. Portfolio Rolling Volatility&quot;) %&gt;%
  hc_add_series(spy_rolling_sd, name = &quot;SPY Volatility&quot;, color = &quot;blue&quot;) %&gt;%
  hc_add_series(roll_portfolio_result, name = &quot;Port Volatility&quot;, color = &quot;green&quot;) %&gt;%
  hc_navigator(enabled = FALSE) %&gt;% 
  hc_scrollbar(enabled = FALSE)</code></pre>
<div id="htmlwidget-1" style="width:100%;height:500px;" class="highchart html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"hc_opts":{"title":{"text":"SPY v. Portfolio Rolling Volatility"},"yAxis":{"title":{"text":null}},"credits":{"enabled":false},"exporting":{"enabled":false},"plotOptions":{"series":{"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"},"bubble":{"minSize":5,"maxSize":25}},"annotationsOptions":{"enabledButtons":false},"tooltip":{"delayForDisplay":10},"series":[{"data":[[1375228800000,0.0230087834710489],[1377820800000,0.0310554927963628],[1380499200000,0.0303154391342273],[1383177600000,0.0333351835060359],[1385683200000,0.033679613898303],[1388448000000,0.0288400976907278],[1391126400000,0.0338190396691738],[1393545600000,0.029904383528237],[1396224000000,0.0305942566371719],[1398816000000,0.0275796530645834],[1401408000000,0.0268834182854031],[1404086400000,0.0266169197325657],[1406764800000,0.019606506360967],[1409270400000,0.0178261554082542],[1412035200000,0.0218704877587742],[1414713600000,0.0226129041709753],[1417132800000,0.0230956127375855],[1419984000000,0.0243598131833272],[1422576000000,0.0279750349266381],[1424995200000,0.0322177953429278],[1427760000000,0.0325097911709751],[1430352000000,0.0316790953242732],[1432857600000,0.0302347213514618],[1435622400000,0.0322755984506811],[1438300800000,0.029389462373966],[1440979200000,0.0321307589009705],[1443571200000,0.032984375371157],[1446163200000,0.050852177600668],[1448841600000,0.0505138108788652],[1451520000000,0.0503340252080932],[1454025600000,0.0522341207818885],[1456704000000,0.046219715155029],[1459382400000,0.0504880420143848],[1461888000000,0.0371553096877483],[1464652800000,0.0378912457951088],[1467244800000,0.0361050285668243],[1469750400000,0.0250938017057704],[1472601600000,0.0246028353527571],[1475193600000,0.0153415995353276],[1477872000000,0.0187392260707039],[1480464000000,0.0224796653731647],[1483056000000,0.0220139494031393],[1485820800000,0.018927657566137],[1488240000000,0.0221800497260555],[1490918400000,0.0218674879816177],[1493337600000,0.0159545004191706],[1496188800000,0.0135388212505291],[1498780800000,0.014675445173365],[1501459200000,0.0148777924782366],[1502236800000,0.0088572794047419]],"name":"SPY Volatility","color":"blue"},{"data":[[1377820800000,0.0241115216143897],[1380499200000,0.0260442402607256],[1383177600000,0.0272674443067543],[1385683200000,0.0288719473982621],[1388448000000,0.0288857557055273],[1391126400000,0.0205191246489011],[1393545600000,0.0260055041878384],[1396224000000,0.0264271524902842],[1398816000000,0.0265816646662814],[1401408000000,0.0249591129630544],[1404086400000,0.0249769037782382],[1406764800000,0.0247281123755299],[1409270400000,0.0199346459519581],[1412035200000,0.0139540306559013],[1414713600000,0.0197192962226576],[1417132800000,0.0198713309717489],[1419984000000,0.0190676195505098],[1422576000000,0.0222013376079352],[1424995200000,0.0230297501738257],[1427760000000,0.0319188848721891],[1430352000000,0.0312580175470481],[1432857600000,0.0321510597602722],[1435622400000,0.031875737738177],[1438300800000,0.031631756790222],[1440979200000,0.0295208333915207],[1443571200000,0.0272649913296038],[1446163200000,0.0278878899612652],[1448841600000,0.0415543963149301],[1451520000000,0.0411460482731848],[1454025600000,0.0412861897878856],[1456704000000,0.0435368174613372],[1459382400000,0.0395236110434442],[1461888000000,0.0461989881404102],[1464652800000,0.0360002783258131],[1467244800000,0.0370928565224689],[1469750400000,0.0348749773237639],[1472601600000,0.0258599246690703],[1475193600000,0.0235703025145043],[1477872000000,0.0130155131890959],[1480464000000,0.0163314552380049],[1483056000000,0.0156270326216257],[1485820800000,0.0141434664632901],[1488240000000,0.0120186849784016],[1490918400000,0.0143345865051231],[1493337600000,0.014532447732245],[1496188800000,0.00807871448547398],[1498780800000,0.00794794549875872],[1501459200000,0.0132875445224473],[1502236800000,0.0138910858549009]],"name":"Port Volatility","color":"green"}],"navigator":{"enabled":false},"scrollbar":{"enabled":false}},"theme":{"chart":{"backgroundColor":"transparent"}},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","drillUpText":"Back to {series.name}","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"thousandsSep":" ","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"stock","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
<p>It is interesting to note that from late April 2016 to late October 2016, SPY’s rolling standard deviation dipped below that of the diversified portfolio. The portfolio volatility was plunging at the same time, but SPY’s was falling faster. What happened over the 6 preceding months to explain this?</p>
<p>Maybe we should add a flag to highlight this event. We can also add flags for the maximum SPY volatility, maximum and minimum portfolio rolling volatility and might as well include a line for the mean rolling volatility of SPY to practice adding horizontal lines.</p>
<p>We will use two methods for adding flags. First, we’ll hard code the date for the flag as “2016-04-29” using the date when rolling SPY volatility dipped below the portfolio. Second, we’ll set a flag with the date<br />
<code>as.Date(index(roll_portfolio_result[which.max(roll_portfolio_result)]),format = &quot;%Y-%m-%d&quot;)</code> which looks like a convoluted mess but is adding a date for whenever the rolling portfolio standard deviation hit its maximum.</p>
<p>This is a bit more ‘dynamic’ because we can change our assets but keep this code the same and it will find the date with the maximum rolling standard deviation. Our first flag is not dynamic in the sense that it is specific to the comparison between SPY and this exact portfolio.</p>
<pre class="r"><code>spy_important_date &lt;- as.Date(c(&quot;2016-04-29&quot;), format = &quot;%Y-%m-%d&quot;)

port_max_date &lt;- as.Date(index(roll_portfolio_result[which.max(roll_portfolio_result)]),
                         format = &quot;%Y-%m-%d&quot;)
port_min_date &lt;- as.Date(index(roll_portfolio_result[which.min(roll_portfolio_result)]),
                         format = &quot;%Y-%m-%d&quot;)
spy_max_date &lt;- as.Date(index(spy_rolling_sd[which.max(spy_rolling_sd)]),
                         format = &quot;%Y-%m-%d&quot;)


highchart(type = &quot;stock&quot;) %&gt;%
  hc_title(text = &quot;SPY v. Portfolio Rolling Volatility&quot;) %&gt;%
  hc_add_series(spy_rolling_sd, name = &quot;SPY Volatility&quot;, color = &quot;blue&quot;, id = &quot;SPY&quot;) %&gt;%
  hc_add_series(roll_portfolio_result, name = &quot;Portf Volatility&quot;, color = &quot;green&quot;, id = &quot;Port&quot;) %&gt;%
  hc_add_series_flags(spy_important_date,
                      title = c(&quot;SPY Vol Dips&quot;), 
                      text = c(&quot;SPY rolling sd dips below portfolio.&quot;),
                      id = &quot;SPY&quot;) %&gt;%
  hc_add_series_flags(spy_max_date,
                      title = c(&quot;SPY Max &quot;), 
                      text = c(&quot;SPY max rolling volatility.&quot;),
                      id = &quot;SPY&quot;) %&gt;%
   hc_add_series_flags(port_max_date,
                      title = c(&quot;Portf Max&quot;), 
                      text = c(&quot;Portfolio maximum rolling volatility.&quot;),
                      id = &quot;Port&quot;) %&gt;%
  hc_add_series_flags(port_min_date,
                      title = c(&quot;Portf Min&quot;), 
                      text = c(&quot;Portfolio min rolling volatility.&quot;),
                      id = &quot;Port&quot;) %&gt;%
  hc_yAxis(title = list(text = &quot;Mean SPY rolling Vol&quot;),
           showFirstLabel = FALSE,
           showLastLabel = FALSE,
           plotLines = list(
             list(value = mean(spy_rolling_sd), color = &quot;#2b908f&quot;, width = 2)))  %&gt;% 
  hc_navigator(enabled = FALSE) %&gt;% 
  hc_scrollbar(enabled = FALSE)</code></pre>
<div id="htmlwidget-2" style="width:100%;height:500px;" class="highchart html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"hc_opts":{"title":{"text":"SPY v. Portfolio Rolling Volatility"},"yAxis":{"title":{"text":"Mean SPY rolling Vol"},"showFirstLabel":false,"showLastLabel":false,"plotLines":[{"value":0.028746879627522,"color":"#2b908f","width":2}]},"credits":{"enabled":false},"exporting":{"enabled":false},"plotOptions":{"series":{"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"},"bubble":{"minSize":5,"maxSize":25}},"annotationsOptions":{"enabledButtons":false},"tooltip":{"delayForDisplay":10},"series":[{"data":[[1375228800000,0.0230087834710489],[1377820800000,0.0310554927963628],[1380499200000,0.0303154391342273],[1383177600000,0.0333351835060359],[1385683200000,0.033679613898303],[1388448000000,0.0288400976907278],[1391126400000,0.0338190396691738],[1393545600000,0.029904383528237],[1396224000000,0.0305942566371719],[1398816000000,0.0275796530645834],[1401408000000,0.0268834182854031],[1404086400000,0.0266169197325657],[1406764800000,0.019606506360967],[1409270400000,0.0178261554082542],[1412035200000,0.0218704877587742],[1414713600000,0.0226129041709753],[1417132800000,0.0230956127375855],[1419984000000,0.0243598131833272],[1422576000000,0.0279750349266381],[1424995200000,0.0322177953429278],[1427760000000,0.0325097911709751],[1430352000000,0.0316790953242732],[1432857600000,0.0302347213514618],[1435622400000,0.0322755984506811],[1438300800000,0.029389462373966],[1440979200000,0.0321307589009705],[1443571200000,0.032984375371157],[1446163200000,0.050852177600668],[1448841600000,0.0505138108788652],[1451520000000,0.0503340252080932],[1454025600000,0.0522341207818885],[1456704000000,0.046219715155029],[1459382400000,0.0504880420143848],[1461888000000,0.0371553096877483],[1464652800000,0.0378912457951088],[1467244800000,0.0361050285668243],[1469750400000,0.0250938017057704],[1472601600000,0.0246028353527571],[1475193600000,0.0153415995353276],[1477872000000,0.0187392260707039],[1480464000000,0.0224796653731647],[1483056000000,0.0220139494031393],[1485820800000,0.018927657566137],[1488240000000,0.0221800497260555],[1490918400000,0.0218674879816177],[1493337600000,0.0159545004191706],[1496188800000,0.0135388212505291],[1498780800000,0.014675445173365],[1501459200000,0.0148777924782366],[1502236800000,0.0088572794047419]],"name":"SPY Volatility","color":"blue","id":"SPY"},{"data":[[1377820800000,0.0241115216143897],[1380499200000,0.0260442402607256],[1383177600000,0.0272674443067543],[1385683200000,0.0288719473982621],[1388448000000,0.0288857557055273],[1391126400000,0.0205191246489011],[1393545600000,0.0260055041878384],[1396224000000,0.0264271524902842],[1398816000000,0.0265816646662814],[1401408000000,0.0249591129630544],[1404086400000,0.0249769037782382],[1406764800000,0.0247281123755299],[1409270400000,0.0199346459519581],[1412035200000,0.0139540306559013],[1414713600000,0.0197192962226576],[1417132800000,0.0198713309717489],[1419984000000,0.0190676195505098],[1422576000000,0.0222013376079352],[1424995200000,0.0230297501738257],[1427760000000,0.0319188848721891],[1430352000000,0.0312580175470481],[1432857600000,0.0321510597602722],[1435622400000,0.031875737738177],[1438300800000,0.031631756790222],[1440979200000,0.0295208333915207],[1443571200000,0.0272649913296038],[1446163200000,0.0278878899612652],[1448841600000,0.0415543963149301],[1451520000000,0.0411460482731848],[1454025600000,0.0412861897878856],[1456704000000,0.0435368174613372],[1459382400000,0.0395236110434442],[1461888000000,0.0461989881404102],[1464652800000,0.0360002783258131],[1467244800000,0.0370928565224689],[1469750400000,0.0348749773237639],[1472601600000,0.0258599246690703],[1475193600000,0.0235703025145043],[1477872000000,0.0130155131890959],[1480464000000,0.0163314552380049],[1483056000000,0.0156270326216257],[1485820800000,0.0141434664632901],[1488240000000,0.0120186849784016],[1490918400000,0.0143345865051231],[1493337600000,0.014532447732245],[1496188800000,0.00807871448547398],[1498780800000,0.00794794549875872],[1501459200000,0.0132875445224473],[1502236800000,0.0138910858549009]],"name":"Portf Volatility","color":"green","id":"Port"},{"data":[{"x":1461888000000,"title":"SPY Vol Dips","text":"SPY rolling sd dips below portfolio."}],"onSeries":"SPY","type":"flags"},{"data":[{"x":1454025600000,"title":"SPY Max ","text":"SPY max rolling volatility."}],"onSeries":"SPY","type":"flags"},{"data":[{"x":1461888000000,"title":"Portf Max","text":"Portfolio maximum rolling volatility."}],"onSeries":"Port","type":"flags"},{"data":[{"x":1498780800000,"title":"Portf Min","text":"Portfolio min rolling volatility."}],"onSeries":"Port","type":"flags"}],"navigator":{"enabled":false},"scrollbar":{"enabled":false}},"theme":{"chart":{"backgroundColor":"transparent"}},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","drillUpText":"Back to {series.name}","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"thousandsSep":" ","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"stock","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
<p>Hover on the flags and you can see the text we added for explanation.</p>
<p>It’s remarkable how rolling volatility has absolutely plunged since early-to-mid 2016. Since August of 2016, both the portfolio and SPY rolling standard deviations have been well below the SPY mean.</p>
<p>Thanks for sticking with this three-part introduction to volatility. Next time, we’ll port our work to Shiny and play with different assets and allocations.</p>
