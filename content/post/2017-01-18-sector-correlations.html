---
author: "Jonathan Regenstein"
author_by: "A Reproducible Finance with R Post by Jonathan Regenstein"
categories: [Reproducible Finance with R, Visualizations, Time Series, Applications, R Language]
date: 2017-01-18
slug: "reproducible-finance-with-r-sector-correlations"
draft: false
tags: [R]
title: "Sector Correlations"
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/dygraphs/dygraph.css" rel="stylesheet" />
<script src="/rmarkdown-libs/dygraphs/dygraph-combined.js"></script>
<script src="/rmarkdown-libs/moment/moment.js"></script>
<script src="/rmarkdown-libs/moment-timezone/moment-timezone-with-data.js"></script>
<script src="/rmarkdown-libs/moment-fquarter/moment-fquarter.min.js"></script>
<script src="/rmarkdown-libs/dygraphs-binding/dygraphs.js"></script>

<p>Welcome to the first installation of reproducible finance for 2017. It’s a new year, a new President takes office soon, and we could be entering a new political-economic environment. What better time to think about a popular topic over the last few years: equity correlations. Elevated correlations are important for several reasons - life is hard for active managers and diversification gains are vanishing - but I personally enjoy thinking about them more from an inference or data exploration perspective. Are changning correlations telling us something about the world? Are sectors diverging? How much can be attributed to the Central Bank regime at hand? So many questions, so many hypotheses to be explored. Let’s get started.</p>
<p>Today, we will build a Notebook and start exploring the historical rolling correlations between sector ETFs and the S&amp;P 500. That is, we want to explore how equity returns in different sectors have been correlated with the returns of the broader index. Perhaps they are all moving in lockstep, perhaps they have been diverging. Either way, this Notebook will be the first step toward an flexdashboard that lets us do more interactive exploration - choosing different sector ETFs and rolling windows.</p>
<p>We are going to accomplish a few things today. We will load up the sector ETF tickers, then build a function to download their price history and calculate weekly returns. We will save this to one xts object. Next we will build a function to calculate the rolling correlations between a chosen sector ETF and the S&amp;P 500. Finally, dygraphs will make its usual appearance to help visualize the rolling correlation time series.</p>
<p>As usual, we will be living in the Rmarkdown world and, by way of disclaimer, the data import and return calculation functions here should be familiar from previous posts. That is by design and hopefully, it won’t be too boring for devotees of this series (I know you’re out there somewhere!). More importantly, I hope the usefulness of reproducible, reusable code is emerging. Some of the code chunks in previous posts might have seemed trivially simple, containing just a simple function and little else. But, the simplicity of those code chunks made it very easy to return to those previous scripts, understand the functions, and use them in this post.</p>
<p>Let’s load up a few packages.</p>
<pre class="r"><code>library(dplyr)
library(quantmod)
library(dygraphs)</code></pre>
<p>Now, we need the tickers and sectors for the sector ETFs. They are copied below and available <a href="http://www.sectorspdr.com/sectorspdr/">here</a>. I deleted the XLRE real estate ETF because it’s only been around since 2015 and I want look back several years in this Notebook.</p>
<pre class="r"><code># List of tickers for sector etfs. 
# Omit XLRE because its inception is 2015. Not really enough to check out long term monthly correlations. 

ticker &lt;- c(&quot;XLY&quot;, &quot;XLP&quot;, &quot;XLE&quot;,    &quot;XLF&quot;, &quot;XLV&quot;,   
            &quot;XLI&quot;, &quot;XLB&quot;, &quot;XLK&quot;, &quot;XLU&quot;, &quot;SPY&quot;)  

# And the accompanying sector names for those ETFs.

sector &lt;- c(&quot;Consumer Discretionary&quot;, &quot;Consumer Staples&quot;, 
            &quot;Energy&quot;, &quot;Financials&quot;, &quot;Health Care&quot;, &quot;Industrials&quot;, 
            &quot;Materials&quot;, &quot;Information Technology&quot;, &quot;Utilities&quot;, &quot;Index&quot;)

etf_ticker_sector &lt;- data_frame(ticker, sector)

etf_ticker_sector</code></pre>
<pre><code>## # A tibble: 10 × 2
##    ticker                 sector
##     &lt;chr&gt;                  &lt;chr&gt;
## 1     XLY Consumer Discretionary
## 2     XLP       Consumer Staples
## 3     XLE                 Energy
## 4     XLF             Financials
## 5     XLV            Health Care
## 6     XLI            Industrials
## 7     XLB              Materials
## 8     XLK Information Technology
## 9     XLU              Utilities
## 10    SPY                  Index</code></pre>
<p>We’ve got our dataframe of tickers and sectors. Let’s build a function to download price history and then convert those price histories to weekly returns. We’ll use a combination of getSymbols() and periodReturn() to accomplish that. If you want to change this script to use daily returns, change the argument below to period = ‘daily’, but be prepared to import quite a bit more data.</p>
<pre class="r"><code># A function to build an xts object of etf returns.

etf_weekly_returns &lt;- function(ticker) {
    
symbols &lt;- getSymbols(ticker, auto.assign = TRUE, warnings = FALSE)

etf_prices &lt;- do.call(merge, lapply(symbols, function(x) Cl(get(x))))
    
etf_returns &lt;- do.call(merge, lapply(etf_prices, 
                                     function(x) periodReturn(x, period = &#39;weekly&#39;, type = &#39;log&#39;)))

#Change the column names to the sector names from our dataframe above.

colnames(etf_returns) &lt;- etf_ticker_sector$sector
    
etf_returns

}

# Let&#39;s pass in our ticker symbols and build an xts object of etf returns
etf_returns &lt;- etf_weekly_returns(etf_ticker_sector$ticker)</code></pre>
<pre><code>##     As of 0.4-0, &#39;getSymbols&#39; uses env=parent.frame() and
##  auto.assign=TRUE by default.
## 
##  This  behavior  will be  phased out in 0.5-0  when the call  will
##  default to use auto.assign=FALSE. getOption(&quot;getSymbols.env&quot;) and 
##  getOptions(&quot;getSymbols.auto.assign&quot;) are now checked for alternate defaults
## 
##  This message is shown once per session and may be disabled by setting 
##  options(&quot;getSymbols.warning4.0&quot;=FALSE). See ?getSymbols for more details.</code></pre>
<pre><code>## pausing 1 second between requests for more than 5 symbols
## pausing 1 second between requests for more than 5 symbols
## pausing 1 second between requests for more than 5 symbols
## pausing 1 second between requests for more than 5 symbols
## pausing 1 second between requests for more than 5 symbols
## pausing 1 second between requests for more than 5 symbols</code></pre>
<pre class="r"><code>head(etf_returns)</code></pre>
<pre><code>##            Consumer Discretionary Consumer Staples       Energy
## 2007-01-05           -0.007034027     -0.005722007 -0.011733539
## 2007-01-12            0.026062578      0.014055350 -0.008620725
## 2007-01-19            0.008875499      0.003765102  0.020354264
## 2007-01-26           -0.019888442     -0.004519819  0.004760584
## 2007-02-02            0.022409825      0.011634547  0.030830343
## 2007-02-09           -0.006315545     -0.010502685 -0.004101903
##              Financials  Health Care  Industrials     Materials
## 2007-01-05 -0.011167160  0.005655589 -0.007693470 -0.0113323889
## 2007-01-12  0.013331718  0.017361037  0.017579216  0.0290876947
## 2007-01-19 -0.001081666  0.011312637  0.001123511  0.0152115609
## 2007-01-26 -0.003795098 -0.012772249 -0.011577145  0.0086291974
## 2007-02-02  0.015362168  0.014501414  0.027452705  0.0151288535
## 2007-02-09 -0.005901386 -0.005485765 -0.009439299 -0.0008194183
##            Information Technology    Utilities        Index
## 2007-01-05            0.007260335 -0.019471313 -0.005888436
## 2007-01-12            0.021886396 -0.006668599  0.019029484
## 2007-01-19           -0.027005903  0.005005572 -0.002936435
## 2007-01-26           -0.001283929  0.005532545 -0.004842978
## 2007-02-02            0.016985546  0.023177534  0.018680358
## 2007-02-09           -0.008881386  0.025021348 -0.006025965</code></pre>
<p>This function has done some good work for us and it was refreshingly comfortable to put in place because we used very similar functionality in this <a href="https://www.rstudio.com/rviews/2016/11/09/reproducible-finance-with-r-the-sharpe-ratio/">post</a> and this <a href="https://www.rstudio.com/rviews/2016/12/14/reproducible-finance-with-r-pulling-and-displaying-etf-data/">post</a>.</p>
<p>A pattern seems to be emerging in these Notebooks: grab tickers, get price history, convert to returns and save new xts object. In an ideal world, that pattern of data import and conversion is getting so familiar as to be commonplace.</p>
<p>That said, enough with the commonplace stuff - let’s get on to something a little more dangerous: rolling correlations amongst etf returns. Correlations are important because high correlations make it hard to find diversification opportunities and they make it hard to deliver alpha - though I suppose it’s always hard to deliver alpha. Fortunately, we don’t have to worry about generating alpha today so let’s get to our function.</p>
<p>Calculating rolling correlations in R is pretty straightforward. We use the rollapply() function, along with the cor() function, pass in our data and a time window, and it’s off to the races. We’ll create our own function below to handle these jobs and return an xts object.</p>
<pre class="r"><code># A function that calculates the rolling correlation between a sector ETF and the SPY SP500 ETF. 

sector_index_correlation &lt;- function(x, window) {
  
    merged_xts &lt;- merge(x, etf_returns$&#39;Index&#39;)

    merged_xts$rolling_test &lt;- rollapply(merged_xts, window, 
                                         function(x) cor(x[,1], x[,2], use = &quot;pairwise.complete.obs&quot;), 
                                         by.column = FALSE)
    
    names(merged_xts) &lt;- c(&quot;Sector Returns&quot;, &quot;SPY Returns&quot;, &quot;Sector/SPY Correlation&quot;)
    
    merged_xts
}</code></pre>
<p>Notice that this function does something that seems unnecessary: it creates a new xts object that holds the sector returns, SPY returns and the rolling correlation. We don’t have much use for that separate object and could probably have just added columns to our original xts object. Indeed, if this were our final product we might spend more time eliminating its present. I choose not to do that here for two reasons. First, this Notebook is built to underlie a flexdashboard that could go into production. I want to get the logic right here, then focus more on efficiency in the final app.</p>
<p>Second, and relatedly, we are prioritizing clarity of workflow in this Notebook. It should be crystal clear how we are moving from an xts object of ETF returns to creating a new XTS object of two returns plus one correlation. The goal is for any collaborators, including my future self, to open this Notebook and see the workflow. If that collaboarator finds this step to be unnecessary and has a more clever solution - that’s fantastic because it means this document is intellegible enough to serve as the basis for more sophisticated work.</p>
<p>Let’s go ahead and use this function. We will pass in a time series of Information Technology ETF returns and a window of size 20 for the rolling correlation.</p>
<pre class="r"><code># Choose a sector ETF and a rolling window and pass them to the function we just build. 
# Let&#39;s go with a 5 month window and the Information Technology sector.
# We will now have a new xts object with 3 time series: sector returns, SPY returns
# and the rolling correlation between those return series.

IT_SPY_correlation &lt;- sector_index_correlation(etf_returns$&#39;Information Technology&#39;, 20)

# Have a peek. The first 20 rows in the correlation column should be 
# NAs. 

head(IT_SPY_correlation, n = 25)</code></pre>
<pre><code>##            Sector Returns   SPY Returns Sector/SPY Correlation
## 2007-01-05    0.007260335 -0.0058884356                     NA
## 2007-01-12    0.021886396  0.0190294841                     NA
## 2007-01-19   -0.027005903 -0.0029364349                     NA
## 2007-01-26   -0.001283929 -0.0048429782                     NA
## 2007-02-02    0.016985546  0.0186803576                     NA
## 2007-02-09   -0.008881386 -0.0060259646                     NA
## 2007-02-16    0.015177315  0.0123590071                     NA
## 2007-02-23    0.003341691 -0.0029549759                     NA
## 2007-03-02   -0.057501940 -0.0467035959                     NA
## 2007-03-09    0.015776007  0.0151013857                     NA
## 2007-03-16   -0.002176236 -0.0161114796                     NA
## 2007-03-23    0.026656737  0.0344812823                     NA
## 2007-03-30   -0.010663355 -0.0097411262                     NA
## 2007-04-05    0.022892097  0.0156515560                     NA
## 2007-04-13    0.001256461  0.0074596420                     NA
## 2007-04-20    0.014131615  0.0224544236                     NA
## 2007-04-27    0.015561370  0.0061043558                     NA
## 2007-05-04    0.016122840  0.0092528469                     NA
## 2007-05-11    0.007171385 -0.0003976208                     NA
## 2007-05-18    0.004752405  0.0115988780              0.8820099
## 2007-05-25   -0.004752405 -0.0061121613              0.8963962
## 2007-06-01    0.018096442  0.0156329832              0.8946237
## 2007-06-08   -0.012159397 -0.0199273050              0.9301269
## 2007-06-15    0.017214861  0.0133507228              0.9311254
## 2007-06-22   -0.009744766 -0.0166001040              0.9302817</code></pre>
<p>Alright, the function seems to have succeeded in building that new xts object and storing the rolling correlation. Now we will use dygraphs to visualize this rolling correlation over time and see if anything jumps out as interesting or puzzling.</p>
<pre class="r"><code># Let&#39;s graph the sector/index rolling correlation using our old friend dygraphs. 
# I&#39;ll add an event for the financial crisis and shade the recession of 2007-2009 with 
# an unimposing pink hue.

dygraph(IT_SPY_correlation$&#39;Sector/SPY Correlation&#39;, main = &quot;Correlation between SP500 and Tech ETF&quot;) %&gt;% 
    dyAxis(&quot;y&quot;, label = &quot;Correlation&quot;) %&gt;% 
    dyRangeSelector(height = 20) %&gt;%
    dyShading(from = &quot;2007-12-01&quot;, to = &quot;2009-06-01&quot;, color = &quot;#FFE6E6&quot;) %&gt;% 
    dyEvent(x = &quot;2008-09-15&quot;, label = &quot;Fin Crisis&quot;, labelLoc = &quot;top&quot;, color = &quot;red&quot;)</code></pre>
<div id="htmlwidget-313a827a26bdc719bd3d" style="width:672px;height:480px;" class="dygraphs html-widget"></div>
<script type="application/json" data-for="htmlwidget-313a827a26bdc719bd3d">{"x":{"attrs":{"axes":{"x":{"pixelsPerLabel":60},"y":[]},"title":"Correlation between SP500 and Tech ETF","labels":["week","Sector/SPY Correlation"],"legend":"auto","retainDateWindow":false,"ylabel":"Correlation","showRangeSelector":true,"rangeSelectorHeight":20,"rangeSelectorPlotFillColor":" #A7B1C4","rangeSelectorPlotStrokeColor":"#808FAB","interactionModel":"Dygraph.Interaction.defaultModel"},"scale":"weekly","annotations":[],"shadings":[{"from":"2007-12-01T00:00:00.000Z","to":"2009-06-01T00:00:00.000Z","color":"#FFE6E6","axis":"x"}],"events":[{"pos":"2008-09-15T00:00:00.000Z","label":"Fin Crisis","labelLoc":"top","color":"red","strokePattern":[7,3],"axis":"x"}],"format":"date","data":[["2007-01-05T00:00:00.000Z","2007-01-12T00:00:00.000Z","2007-01-19T00:00:00.000Z","2007-01-26T00:00:00.000Z","2007-02-02T00:00:00.000Z","2007-02-09T00:00:00.000Z","2007-02-16T00:00:00.000Z","2007-02-23T00:00:00.000Z","2007-03-02T00:00:00.000Z","2007-03-09T00:00:00.000Z","2007-03-16T00:00:00.000Z","2007-03-23T00:00:00.000Z","2007-03-30T00:00:00.000Z","2007-04-05T00:00:00.000Z","2007-04-13T00:00:00.000Z","2007-04-20T00:00:00.000Z","2007-04-27T00:00:00.000Z","2007-05-04T00:00:00.000Z","2007-05-11T00:00:00.000Z","2007-05-18T00:00:00.000Z","2007-05-25T00:00:00.000Z","2007-06-01T00:00:00.000Z","2007-06-08T00:00:00.000Z","2007-06-15T00:00:00.000Z","2007-06-22T00:00:00.000Z","2007-06-29T00:00:00.000Z","2007-07-06T00:00:00.000Z","2007-07-13T00:00:00.000Z","2007-07-20T00:00:00.000Z","2007-07-27T00:00:00.000Z","2007-08-03T00:00:00.000Z","2007-08-10T00:00:00.000Z","2007-08-17T00:00:00.000Z","2007-08-24T00:00:00.000Z","2007-08-31T00:00:00.000Z","2007-09-07T00:00:00.000Z","2007-09-14T00:00:00.000Z","2007-09-21T00:00:00.000Z","2007-09-28T00:00:00.000Z","2007-10-05T00:00:00.000Z","2007-10-12T00:00:00.000Z","2007-10-19T00:00:00.000Z","2007-10-26T00:00:00.000Z","2007-11-02T00:00:00.000Z","2007-11-09T00:00:00.000Z","2007-11-16T00:00:00.000Z","2007-11-23T00:00:00.000Z","2007-11-30T00:00:00.000Z","2007-12-07T00:00:00.000Z","2007-12-14T00:00:00.000Z","2007-12-21T00:00:00.000Z","2007-12-28T00:00:00.000Z","2008-01-04T00:00:00.000Z","2008-01-11T00:00:00.000Z","2008-01-18T00:00:00.000Z","2008-01-25T00:00:00.000Z","2008-02-01T00:00:00.000Z","2008-02-08T00:00:00.000Z","2008-02-15T00:00:00.000Z","2008-02-22T00:00:00.000Z","2008-02-29T00:00:00.000Z","2008-03-07T00:00:00.000Z","2008-03-14T00:00:00.000Z","2008-03-20T00:00:00.000Z","2008-03-28T00:00:00.000Z","2008-04-04T00:00:00.000Z","2008-04-11T00:00:00.000Z","2008-04-18T00:00:00.000Z","2008-04-25T00:00:00.000Z","2008-05-02T00:00:00.000Z","2008-05-09T00:00:00.000Z","2008-05-16T00:00:00.000Z","2008-05-23T00:00:00.000Z","2008-05-30T00:00:00.000Z","2008-06-06T00:00:00.000Z","2008-06-13T00:00:00.000Z","2008-06-20T00:00:00.000Z","2008-06-27T00:00:00.000Z","2008-07-03T00:00:00.000Z","2008-07-11T00:00:00.000Z","2008-07-18T00:00:00.000Z","2008-07-25T00:00:00.000Z","2008-08-01T00:00:00.000Z","2008-08-08T00:00:00.000Z","2008-08-15T00:00:00.000Z","2008-08-22T00:00:00.000Z","2008-08-29T00:00:00.000Z","2008-09-05T00:00:00.000Z","2008-09-12T00:00:00.000Z","2008-09-19T00:00:00.000Z","2008-09-26T00:00:00.000Z","2008-10-03T00:00:00.000Z","2008-10-10T00:00:00.000Z","2008-10-17T00:00:00.000Z","2008-10-24T00:00:00.000Z","2008-10-31T00:00:00.000Z","2008-11-07T00:00:00.000Z","2008-11-14T00:00:00.000Z","2008-11-21T00:00:00.000Z","2008-11-28T00:00:00.000Z","2008-12-05T00:00:00.000Z","2008-12-12T00:00:00.000Z","2008-12-19T00:00:00.000Z","2008-12-26T00:00:00.000Z","2009-01-02T00:00:00.000Z","2009-01-09T00:00:00.000Z","2009-01-16T00:00:00.000Z","2009-01-23T00:00:00.000Z","2009-01-30T00:00:00.000Z","2009-02-06T00:00:00.000Z","2009-02-13T00:00:00.000Z","2009-02-20T00:00:00.000Z","2009-02-27T00:00:00.000Z","2009-03-06T00:00:00.000Z","2009-03-13T00:00:00.000Z","2009-03-20T00:00:00.000Z","2009-03-27T00:00:00.000Z","2009-04-03T00:00:00.000Z","2009-04-09T00:00:00.000Z","2009-04-17T00:00:00.000Z","2009-04-24T00:00:00.000Z","2009-05-01T00:00:00.000Z","2009-05-08T00:00:00.000Z","2009-05-15T00:00:00.000Z","2009-05-22T00:00:00.000Z","2009-05-29T00:00:00.000Z","2009-06-05T00:00:00.000Z","2009-06-12T00:00:00.000Z","2009-06-19T00:00:00.000Z","2009-06-26T00:00:00.000Z","2009-07-02T00:00:00.000Z","2009-07-10T00:00:00.000Z","2009-07-17T00:00:00.000Z","2009-07-24T00:00:00.000Z","2009-07-31T00:00:00.000Z","2009-08-07T00:00:00.000Z","2009-08-14T00:00:00.000Z","2009-08-21T00:00:00.000Z","2009-08-28T00:00:00.000Z","2009-09-04T00:00:00.000Z","2009-09-11T00:00:00.000Z","2009-09-18T00:00:00.000Z","2009-09-25T00:00:00.000Z","2009-10-02T00:00:00.000Z","2009-10-09T00:00:00.000Z","2009-10-16T00:00:00.000Z","2009-10-23T00:00:00.000Z","2009-10-30T00:00:00.000Z","2009-11-06T00:00:00.000Z","2009-11-13T00:00:00.000Z","2009-11-20T00:00:00.000Z","2009-11-27T00:00:00.000Z","2009-12-04T00:00:00.000Z","2009-12-11T00:00:00.000Z","2009-12-18T00:00:00.000Z","2009-12-24T00:00:00.000Z","2009-12-31T00:00:00.000Z","2010-01-08T00:00:00.000Z","2010-01-15T00:00:00.000Z","2010-01-22T00:00:00.000Z","2010-01-29T00:00:00.000Z","2010-02-05T00:00:00.000Z","2010-02-12T00:00:00.000Z","2010-02-19T00:00:00.000Z","2010-02-26T00:00:00.000Z","2010-03-05T00:00:00.000Z","2010-03-12T00:00:00.000Z","2010-03-19T00:00:00.000Z","2010-03-26T00:00:00.000Z","2010-04-01T00:00:00.000Z","2010-04-09T00:00:00.000Z","2010-04-16T00:00:00.000Z","2010-04-23T00:00:00.000Z","2010-04-30T00:00:00.000Z","2010-05-07T00:00:00.000Z","2010-05-14T00:00:00.000Z","2010-05-21T00:00:00.000Z","2010-05-28T00:00:00.000Z","2010-06-04T00:00:00.000Z","2010-06-11T00:00:00.000Z","2010-06-18T00:00:00.000Z","2010-06-25T00:00:00.000Z","2010-07-02T00:00:00.000Z","2010-07-09T00:00:00.000Z","2010-07-16T00:00:00.000Z","2010-07-23T00:00:00.000Z","2010-07-30T00:00:00.000Z","2010-08-06T00:00:00.000Z","2010-08-13T00:00:00.000Z","2010-08-20T00:00:00.000Z","2010-08-27T00:00:00.000Z","2010-09-03T00:00:00.000Z","2010-09-10T00:00:00.000Z","2010-09-17T00:00:00.000Z","2010-09-24T00:00:00.000Z","2010-10-01T00:00:00.000Z","2010-10-08T00:00:00.000Z","2010-10-15T00:00:00.000Z","2010-10-22T00:00:00.000Z","2010-10-29T00:00:00.000Z","2010-11-05T00:00:00.000Z","2010-11-12T00:00:00.000Z","2010-11-19T00:00:00.000Z","2010-11-26T00:00:00.000Z","2010-12-03T00:00:00.000Z","2010-12-10T00:00:00.000Z","2010-12-17T00:00:00.000Z","2010-12-23T00:00:00.000Z","2010-12-31T00:00:00.000Z","2011-01-07T00:00:00.000Z","2011-01-14T00:00:00.000Z","2011-01-21T00:00:00.000Z","2011-01-28T00:00:00.000Z","2011-02-04T00:00:00.000Z","2011-02-11T00:00:00.000Z","2011-02-18T00:00:00.000Z","2011-02-25T00:00:00.000Z","2011-03-04T00:00:00.000Z","2011-03-11T00:00:00.000Z","2011-03-18T00:00:00.000Z","2011-03-25T00:00:00.000Z","2011-04-01T00:00:00.000Z","2011-04-08T00:00:00.000Z","2011-04-15T00:00:00.000Z","2011-04-21T00:00:00.000Z","2011-04-29T00:00:00.000Z","2011-05-06T00:00:00.000Z","2011-05-13T00:00:00.000Z","2011-05-20T00:00:00.000Z","2011-05-27T00:00:00.000Z","2011-06-03T00:00:00.000Z","2011-06-10T00:00:00.000Z","2011-06-17T00:00:00.000Z","2011-06-24T00:00:00.000Z","2011-07-01T00:00:00.000Z","2011-07-08T00:00:00.000Z","2011-07-15T00:00:00.000Z","2011-07-22T00:00:00.000Z","2011-07-29T00:00:00.000Z","2011-08-05T00:00:00.000Z","2011-08-12T00:00:00.000Z","2011-08-19T00:00:00.000Z","2011-08-26T00:00:00.000Z","2011-09-02T00:00:00.000Z","2011-09-09T00:00:00.000Z","2011-09-16T00:00:00.000Z","2011-09-23T00:00:00.000Z","2011-09-30T00:00:00.000Z","2011-10-07T00:00:00.000Z","2011-10-14T00:00:00.000Z","2011-10-21T00:00:00.000Z","2011-10-28T00:00:00.000Z","2011-11-04T00:00:00.000Z","2011-11-11T00:00:00.000Z","2011-11-18T00:00:00.000Z","2011-11-25T00:00:00.000Z","2011-12-02T00:00:00.000Z","2011-12-09T00:00:00.000Z","2011-12-16T00:00:00.000Z","2011-12-23T00:00:00.000Z","2011-12-30T00:00:00.000Z","2012-01-06T00:00:00.000Z","2012-01-13T00:00:00.000Z","2012-01-20T00:00:00.000Z","2012-01-27T00:00:00.000Z","2012-02-03T00:00:00.000Z","2012-02-10T00:00:00.000Z","2012-02-17T00:00:00.000Z","2012-02-24T00:00:00.000Z","2012-03-02T00:00:00.000Z","2012-03-09T00:00:00.000Z","2012-03-16T00:00:00.000Z","2012-03-23T00:00:00.000Z","2012-03-30T00:00:00.000Z","2012-04-05T00:00:00.000Z","2012-04-13T00:00:00.000Z","2012-04-20T00:00:00.000Z","2012-04-27T00:00:00.000Z","2012-05-04T00:00:00.000Z","2012-05-11T00:00:00.000Z","2012-05-18T00:00:00.000Z","2012-05-25T00:00:00.000Z","2012-06-01T00:00:00.000Z","2012-06-08T00:00:00.000Z","2012-06-15T00:00:00.000Z","2012-06-22T00:00:00.000Z","2012-06-29T00:00:00.000Z","2012-07-06T00:00:00.000Z","2012-07-13T00:00:00.000Z","2012-07-20T00:00:00.000Z","2012-07-27T00:00:00.000Z","2012-08-03T00:00:00.000Z","2012-08-10T00:00:00.000Z","2012-08-17T00:00:00.000Z","2012-08-24T00:00:00.000Z","2012-08-31T00:00:00.000Z","2012-09-07T00:00:00.000Z","2012-09-14T00:00:00.000Z","2012-09-21T00:00:00.000Z","2012-09-28T00:00:00.000Z","2012-10-05T00:00:00.000Z","2012-10-12T00:00:00.000Z","2012-10-19T00:00:00.000Z","2012-10-26T00:00:00.000Z","2012-11-02T00:00:00.000Z","2012-11-09T00:00:00.000Z","2012-11-16T00:00:00.000Z","2012-11-23T00:00:00.000Z","2012-11-30T00:00:00.000Z","2012-12-07T00:00:00.000Z","2012-12-14T00:00:00.000Z","2012-12-21T00:00:00.000Z","2012-12-28T00:00:00.000Z","2013-01-04T00:00:00.000Z","2013-01-11T00:00:00.000Z","2013-01-18T00:00:00.000Z","2013-01-25T00:00:00.000Z","2013-02-01T00:00:00.000Z","2013-02-08T00:00:00.000Z","2013-02-15T00:00:00.000Z","2013-02-22T00:00:00.000Z","2013-03-01T00:00:00.000Z","2013-03-08T00:00:00.000Z","2013-03-15T00:00:00.000Z","2013-03-22T00:00:00.000Z","2013-03-28T00:00:00.000Z","2013-04-05T00:00:00.000Z","2013-04-12T00:00:00.000Z","2013-04-19T00:00:00.000Z","2013-04-26T00:00:00.000Z","2013-05-03T00:00:00.000Z","2013-05-10T00:00:00.000Z","2013-05-17T00:00:00.000Z","2013-05-24T00:00:00.000Z","2013-05-31T00:00:00.000Z","2013-06-07T00:00:00.000Z","2013-06-14T00:00:00.000Z","2013-06-21T00:00:00.000Z","2013-06-28T00:00:00.000Z","2013-07-05T00:00:00.000Z","2013-07-12T00:00:00.000Z","2013-07-19T00:00:00.000Z","2013-07-26T00:00:00.000Z","2013-08-02T00:00:00.000Z","2013-08-09T00:00:00.000Z","2013-08-16T00:00:00.000Z","2013-08-23T00:00:00.000Z","2013-08-30T00:00:00.000Z","2013-09-06T00:00:00.000Z","2013-09-13T00:00:00.000Z","2013-09-20T00:00:00.000Z","2013-09-27T00:00:00.000Z","2013-10-04T00:00:00.000Z","2013-10-11T00:00:00.000Z","2013-10-18T00:00:00.000Z","2013-10-25T00:00:00.000Z","2013-11-01T00:00:00.000Z","2013-11-08T00:00:00.000Z","2013-11-15T00:00:00.000Z","2013-11-22T00:00:00.000Z","2013-11-29T00:00:00.000Z","2013-12-06T00:00:00.000Z","2013-12-13T00:00:00.000Z","2013-12-20T00:00:00.000Z","2013-12-27T00:00:00.000Z","2014-01-03T00:00:00.000Z","2014-01-10T00:00:00.000Z","2014-01-17T00:00:00.000Z","2014-01-24T00:00:00.000Z","2014-01-31T00:00:00.000Z","2014-02-07T00:00:00.000Z","2014-02-14T00:00:00.000Z","2014-02-21T00:00:00.000Z","2014-02-28T00:00:00.000Z","2014-03-07T00:00:00.000Z","2014-03-14T00:00:00.000Z","2014-03-21T00:00:00.000Z","2014-03-28T00:00:00.000Z","2014-04-04T00:00:00.000Z","2014-04-11T00:00:00.000Z","2014-04-17T00:00:00.000Z","2014-04-25T00:00:00.000Z","2014-05-02T00:00:00.000Z","2014-05-09T00:00:00.000Z","2014-05-16T00:00:00.000Z","2014-05-23T00:00:00.000Z","2014-05-30T00:00:00.000Z","2014-06-06T00:00:00.000Z","2014-06-13T00:00:00.000Z","2014-06-20T00:00:00.000Z","2014-06-27T00:00:00.000Z","2014-07-03T00:00:00.000Z","2014-07-11T00:00:00.000Z","2014-07-18T00:00:00.000Z","2014-07-25T00:00:00.000Z","2014-08-01T00:00:00.000Z","2014-08-08T00:00:00.000Z","2014-08-15T00:00:00.000Z","2014-08-22T00:00:00.000Z","2014-08-29T00:00:00.000Z","2014-09-05T00:00:00.000Z","2014-09-12T00:00:00.000Z","2014-09-19T00:00:00.000Z","2014-09-26T00:00:00.000Z","2014-10-03T00:00:00.000Z","2014-10-10T00:00:00.000Z","2014-10-17T00:00:00.000Z","2014-10-24T00:00:00.000Z","2014-10-31T00:00:00.000Z","2014-11-07T00:00:00.000Z","2014-11-14T00:00:00.000Z","2014-11-21T00:00:00.000Z","2014-11-28T00:00:00.000Z","2014-12-05T00:00:00.000Z","2014-12-12T00:00:00.000Z","2014-12-19T00:00:00.000Z","2014-12-26T00:00:00.000Z","2015-01-02T00:00:00.000Z","2015-01-09T00:00:00.000Z","2015-01-16T00:00:00.000Z","2015-01-23T00:00:00.000Z","2015-01-30T00:00:00.000Z","2015-02-06T00:00:00.000Z","2015-02-13T00:00:00.000Z","2015-02-20T00:00:00.000Z","2015-02-27T00:00:00.000Z","2015-03-06T00:00:00.000Z","2015-03-13T00:00:00.000Z","2015-03-20T00:00:00.000Z","2015-03-27T00:00:00.000Z","2015-04-02T00:00:00.000Z","2015-04-10T00:00:00.000Z","2015-04-17T00:00:00.000Z","2015-04-24T00:00:00.000Z","2015-05-01T00:00:00.000Z","2015-05-08T00:00:00.000Z","2015-05-15T00:00:00.000Z","2015-05-22T00:00:00.000Z","2015-05-29T00:00:00.000Z","2015-06-05T00:00:00.000Z","2015-06-12T00:00:00.000Z","2015-06-19T00:00:00.000Z","2015-06-26T00:00:00.000Z","2015-07-02T00:00:00.000Z","2015-07-10T00:00:00.000Z","2015-07-17T00:00:00.000Z","2015-07-24T00:00:00.000Z","2015-07-31T00:00:00.000Z","2015-08-07T00:00:00.000Z","2015-08-14T00:00:00.000Z","2015-08-21T00:00:00.000Z","2015-08-28T00:00:00.000Z","2015-09-04T00:00:00.000Z","2015-09-11T00:00:00.000Z","2015-09-18T00:00:00.000Z","2015-09-25T00:00:00.000Z","2015-10-02T00:00:00.000Z","2015-10-09T00:00:00.000Z","2015-10-16T00:00:00.000Z","2015-10-23T00:00:00.000Z","2015-10-30T00:00:00.000Z","2015-11-06T00:00:00.000Z","2015-11-13T00:00:00.000Z","2015-11-20T00:00:00.000Z","2015-11-27T00:00:00.000Z","2015-12-04T00:00:00.000Z","2015-12-11T00:00:00.000Z","2015-12-18T00:00:00.000Z","2015-12-24T00:00:00.000Z","2015-12-31T00:00:00.000Z","2016-01-08T00:00:00.000Z","2016-01-15T00:00:00.000Z","2016-01-22T00:00:00.000Z","2016-01-29T00:00:00.000Z","2016-02-05T00:00:00.000Z","2016-02-12T00:00:00.000Z","2016-02-19T00:00:00.000Z","2016-02-26T00:00:00.000Z","2016-03-04T00:00:00.000Z","2016-03-11T00:00:00.000Z","2016-03-18T00:00:00.000Z","2016-03-24T00:00:00.000Z","2016-04-01T00:00:00.000Z","2016-04-08T00:00:00.000Z","2016-04-15T00:00:00.000Z","2016-04-22T00:00:00.000Z","2016-04-29T00:00:00.000Z","2016-05-06T00:00:00.000Z","2016-05-13T00:00:00.000Z","2016-05-20T00:00:00.000Z","2016-05-27T00:00:00.000Z","2016-06-03T00:00:00.000Z","2016-06-10T00:00:00.000Z","2016-06-17T00:00:00.000Z","2016-06-24T00:00:00.000Z","2016-07-01T00:00:00.000Z","2016-07-08T00:00:00.000Z","2016-07-15T00:00:00.000Z","2016-07-22T00:00:00.000Z","2016-07-29T00:00:00.000Z","2016-08-05T00:00:00.000Z","2016-08-12T00:00:00.000Z","2016-08-19T00:00:00.000Z","2016-08-26T00:00:00.000Z","2016-09-02T00:00:00.000Z","2016-09-09T00:00:00.000Z","2016-09-16T00:00:00.000Z","2016-09-23T00:00:00.000Z","2016-09-30T00:00:00.000Z","2016-10-07T00:00:00.000Z","2016-10-14T00:00:00.000Z","2016-10-21T00:00:00.000Z","2016-10-28T00:00:00.000Z","2016-11-04T00:00:00.000Z","2016-11-11T00:00:00.000Z","2016-11-18T00:00:00.000Z","2016-11-25T00:00:00.000Z","2016-12-02T00:00:00.000Z","2016-12-09T00:00:00.000Z","2016-12-16T00:00:00.000Z","2016-12-23T00:00:00.000Z","2016-12-30T00:00:00.000Z","2017-01-06T00:00:00.000Z","2017-01-13T00:00:00.000Z","2017-01-20T00:00:00.000Z","2017-01-27T00:00:00.000Z","2017-02-03T00:00:00.000Z","2017-02-10T00:00:00.000Z","2017-02-17T00:00:00.000Z","2017-02-24T00:00:00.000Z","2017-03-03T00:00:00.000Z","2017-03-10T00:00:00.000Z","2017-03-17T00:00:00.000Z","2017-03-23T00:00:00.000Z"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.882009868611482,0.89639620738816,0.894623668366187,0.930126938147475,0.931125427505195,0.930281677942156,0.930394053139138,0.93157469379101,0.932820642856053,0.88872654820673,0.941355907382818,0.942540035721515,0.922777908475206,0.890219104431397,0.89264530260361,0.886332903777741,0.893755353596777,0.872516511174197,0.877087915200832,0.878601874448131,0.884486062778509,0.882058815514466,0.876876381886743,0.882244139294026,0.860919824283791,0.838014154321994,0.838279516609103,0.832527062145364,0.82607121049495,0.836993076782081,0.796642616989866,0.79466704143585,0.802550596446245,0.846690492809674,0.820424123675434,0.8430391755578,0.832613815094085,0.847582395839352,0.859596571829904,0.863306872388838,0.855750695251177,0.8560491315787,0.851871968001925,0.840030575901434,0.867296042235348,0.87080142042679,0.887981285418058,0.891663043978797,0.899547804661973,0.899197299456943,0.907583606879088,0.905334807901238,0.910222780581982,0.912509969988313,0.928702961584877,0.920913306216911,0.930713735137361,0.94002075450282,0.934412869933405,0.921970103146809,0.928184803291042,0.930956904744918,0.940499785492708,0.927725177018749,0.920968335601088,0.921219782913846,0.916229677628881,0.903490460174958,0.895551209824133,0.894664772859278,0.881990228357755,0.853801166212627,0.902621974777728,0.914858108289064,0.922798046099779,0.919513903099291,0.93696996976189,0.935328931369585,0.936925452297783,0.938498605897526,0.94991160962515,0.949685809857998,0.949816434691477,0.950624178934631,0.956967541588698,0.959528771667062,0.959145072759651,0.960561813364816,0.961574810389801,0.960590804004404,0.958827878466148,0.960987673225743,0.965093337591458,0.95927473579906,0.953081064793193,0.963348796940412,0.954521735000699,0.964177300787605,0.957494111147315,0.946759060765761,0.938201867925746,0.936948572704074,0.937100610541652,0.851259792547727,0.852804363274825,0.836472516319004,0.83658490107239,0.824674828574868,0.823458336243859,0.830487824915226,0.838730242294831,0.828411642806193,0.800620757486442,0.803476517752319,0.776685895920438,0.71811854270478,0.71282691436304,0.682668166584454,0.679733474184317,0.687758958097791,0.696037062850163,0.706223042251071,0.705735592665899,0.923471319597428,0.94195826118503,0.94374818628953,0.934527053225884,0.933704280967376,0.943637619295564,0.950573877594234,0.949743525078384,0.944540987084846,0.941435048291607,0.924584185245784,0.916270179645517,0.911551283404537,0.933230057936271,0.934137726650809,0.8983272626737,0.895553691854011,0.911750579682076,0.900056631694688,0.894869130968903,0.89438743711231,0.893203325797245,0.878897357560809,0.893245866611085,0.906582879329671,0.892035651198177,0.881153549732186,0.868771345740389,0.872739775739494,0.861056323067312,0.863838807922276,0.881623957137822,0.937805162670445,0.940215551150497,0.949134169492691,0.965727931711275,0.95988372630849,0.949480826779233,0.956485377668895,0.965562511767643,0.971385414889408,0.976350315094039,0.973651221079678,0.975054802009941,0.972562218465973,0.972932686060766,0.9736640376052,0.972612736569777,0.970355501546774,0.974710872904095,0.974560268472055,0.96045747169878,0.950878334440102,0.949221100144066,0.941524814916619,0.929676436148147,0.932884820748953,0.937118796004643,0.93709593426024,0.931261934246828,0.905409961649264,0.881379205729466,0.881066731773446,0.868619330388036,0.872704683166344,0.869669573055155,0.812125388527252,0.814921427350433,0.805150221388754,0.800111691591278,0.79600584320039,0.859006569492603,0.846384494778769,0.837539691279261,0.859919090440606,0.902899906766342,0.907457576390327,0.929488889865148,0.928314115350427,0.912172407746556,0.91224670821375,0.929295626414595,0.940097165030988,0.935610423548652,0.924260673527778,0.92633339089636,0.925747674691079,0.930674552387104,0.928547708925286,0.937457003782537,0.94600042618036,0.930552011414689,0.961677066142955,0.959632469080871,0.958963756948613,0.961271949319374,0.96210926137806,0.962611180020521,0.960842832055477,0.957419961171142,0.964897683020213,0.963288721517906,0.960733236847145,0.967235427527916,0.95354703894685,0.948162809642396,0.952595261822757,0.960277978424035,0.941354188144352,0.94389444602858,0.946291320922276,0.945129041896022,0.940901227068365,0.944981420519279,0.952929853543947,0.952591778086156,0.952373650503562,0.946481740101135,0.947226014600584,0.94685260738958,0.943403290252459,0.944928105846251,0.946093468086701,0.944101424614336,0.950690602580542,0.953715253611068,0.952792871125259,0.944186633849537,0.974493313026828,0.973044898320156,0.971677442931221,0.972741023797147,0.966977909918811,0.958652214495075,0.89532368107682,0.896869285572475,0.874227475878343,0.912539902246047,0.939912396348665,0.93510090088096,0.942755971576812,0.948440434585445,0.944300247817487,0.938810784181883,0.937643551012184,0.935245743479229,0.91984592566673,0.91460445859138,0.916247054299802,0.907221615524209,0.910119189745327,0.906876745682511,0.910696191223952,0.906321901051564,0.927312198666894,0.926498352241539,0.917201661556044,0.91473355442069,0.852288742614378,0.87346898093947,0.81665122240188,0.755093839223704,0.757976136169897,0.805619954498791,0.82201882194805,0.870249563129556,0.883844393736128,0.882786823488884,0.879981178554337,0.884758964866877,0.891854337628294,0.922536000046478,0.922811941798086,0.915019951309569,0.900161682055584,0.887172208871889,0.894519126736872,0.889323457863162,0.894899594670475,0.880039408756929,0.92209081849229,0.923863201767369,0.922820341619374,0.911059909345753,0.907943357290975,0.889534010159546,0.914337401221914,0.922942517588182,0.904388953875893,0.908665292789139,0.90310527149848,0.899631301171307,0.871104406936193,0.888004731076489,0.91931294272786,0.934621794739475,0.933357527471261,0.938257454770141,0.939332008463583,0.898693080161883,0.882578840414364,0.883618596407203,0.883722846329121,0.858217794850265,0.853451941269634,0.858119556056964,0.842055947949924,0.837219072783716,0.847367504965347,0.84313002586829,0.827601106293205,0.826237109828016,0.856312254382341,0.860332510460119,0.851949656524568,0.804032619510255,0.811871141460707,0.795472384967536,0.721529407425515,0.849273483910156,0.878313894368207,0.887912147037235,0.882791202209688,0.913087632303414,0.9117791718058,0.836595513659237,0.869205246296818,0.863466513241688,0.867889524306851,0.884544046204418,0.884212898036891,0.884049713318966,0.852270477645461,0.877643874944018,0.871389881235101,0.872206168317545,0.859053353878408,0.884016173936882,0.91329242516501,0.90988734705487,0.898478644845867,0.890403969668449,0.878293320009831,0.881634051438478,0.887429505782425,0.910267411337857,0.903957042504402,0.88777091694801,0.879650814148796,0.863700102359505,0.858289106515027,0.850483421869588,0.862442336428626,0.874877346212069,0.870954565313623,0.875917928655095,0.901425771973309,0.866354624235668,0.847440751961013,0.859454107020039,0.850845352497222,0.870928846847957,0.886282780701303,0.915910983548846,0.915026270228843,0.943581321025586,0.951218798934343,0.962592800304601,0.953988702465735,0.940401586239853,0.926014326119466,0.914538909511282,0.933081072984159,0.929915914710571,0.930356117655682,0.929895864599884,0.925130802002278,0.926657383529761,0.92816451942513,0.939594321466476,0.944756851339376,0.941207945686643,0.941154690379939,0.93028646644255,0.931879172444096,0.921662504260659,0.918423313001563,0.925307157786947,0.932126424152915,0.940904758410219,0.955019976028747,0.953304954122241,0.948683097709863,0.953428878195296,0.953680326730849,0.951247346115196,0.952171837642435,0.950900501446933,0.944754814587414,0.926386421415982,0.927238130434668,0.917710334104383,0.909138688814426,0.923208976687566,0.927289541757706,0.920603371810833,0.913598232704844,0.900990560644125,0.94771281418213,0.940712900207074,0.940519314535948,0.947746547310768,0.948118982558831,0.947663256753299,0.944275022164544,0.949639113775738,0.951192375148743,0.946948941914507,0.947733224240073,0.951865570775009,0.958282690200217,0.961764707451337,0.961838206188472,0.960375140600664,0.962741326922433,0.966146190579566,0.963924792439567,0.96440910368914,0.963971182278428,0.970046376323949,0.968236141158825,0.96766482397509,0.968742498862409,0.970601952929947,0.974077493546502,0.972504172117028,0.972501359730907,0.979409070021339,0.979803500258982,0.97837586587305,0.976838626101853,0.973787497489621,0.974008697637284,0.95616977125134,0.945896153105053,0.942831210257574,0.939582341236228,0.936745943065741,0.909062961922669,0.908653109036026,0.90918660367352,0.912185434660259,0.890380198743003,0.893439448399631,0.880429454263924,0.881517447348355,0.861528880799173,0.84350886989254,0.841632901300096,0.847567028245217,0.836015074459,0.817097233606457,0.822760441685308,0.915758867616332,0.898547735372562,0.885121775801818,0.883641711837632,0.888328872603158,0.872392145542029,0.875363971512212,0.876098846588909,0.876790623300233,0.778350155304277,0.739922376120829,0.738217622436721,0.704216962493225,0.778009770913344,0.792596825315964,0.793995043552431,0.800853439706685,0.812291024105335,0.812474964471585,0.810807722640305,0.777410812137181,0.820518893410709,0.82678536033314,0.834803797622674,0.833075674202895,0.829171710689881,0.821990185696194,0.816281471683799,0.789668045626429]]},"evals":["attrs.interactionModel"],"jsHooks":[]}</script>
<p>The correlation between the Tech ETF and the S&amp;P 500 ETF seems quite high. It dipped a bit in the middle of 2009 and again towards the end of 2016. It would be interesting to see if this was true of the other sector ETFs as well. In other words, were these periods of generally declining correlations, or was it limited to the technology/SP500 relationship?</p>
<p>The best way to do some exploratory analysis on that is, no surprise, build a shiny app that allows users to choose their own sectors and rolling windows. We’ll do that next time - see you in a few days!</p>
