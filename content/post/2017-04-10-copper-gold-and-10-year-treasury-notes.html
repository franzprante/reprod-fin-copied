---
title: "Copper, Gold and Ten-Year Treasury Notes"
author: "Jonathan Regenstein"
date: '2017-04-12'
draft: yes
tags:
- R
- R Markdown
- time series
- dygraphs
categories:
- Reproducible Finance with R
- Data Science
- Statistics
- R Language
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/dygraphs/dygraph.css" rel="stylesheet" />
<script src="/rmarkdown-libs/dygraphs/dygraph-combined.js"></script>
<script src="/rmarkdown-libs/moment/moment.js"></script>
<script src="/rmarkdown-libs/moment-timezone/moment-timezone-with-data.js"></script>
<script src="/rmarkdown-libs/dygraphs-binding/dygraphs.js"></script>

<p>Today, we will continue getting familiar with data from Quandl, but will also devote more time to expanding our dygraphs toolkit. We will be building up a data visualization in discrete pieces, which isn’t very efficient, but will make things easier when we move this project into production as a Shiny app. From a substantive perspective, we will examine the relationship between the price ratio of copper-gold and 10-year Treasure yields.</p>
<p>Why do we care about the copper-gold price ratio and Treasury yields? First, both Jeff Gundlach (in <a href="http://doubleline.com/latest-webcasts/">this webcast</a>) and <a href="http://robinsonglobalstrategies.com/">Adam Robinson</a> say so, and that’s probably good enough. The theory goes like this:</p>
<p>Copper is a useful industrial metal whose price tends to rise when the global economy expands. As firms produce more goods that require copper as an input, the increased demand for copper drives the price higher. Gold, on the other hand, is a somewhat less useful metal whose prices tends to rise when investors are fearful about a contracting global economy. Gold is a safe-haven investment, and a rising gold price signals either a contracting economy, investor fears of a contracting economy, or both. Gold prices tend to fall when the economy is humming along nicely. Thus, the copper-gold price ratio tends to be increasing when the economy is expanding.</p>
<p>The yield on 10-year Treasury Notes also tends to rise during economic expansion because investors’ inflation expectations are on the rise. When investors expect inflation to increase, they anticipate an uptick in interest rates (for those of you who are too young to remember what an interest rate is, take a look at rates in the mid-1980s) and start to seek higher yields today. That can drive down Treasury prices and increase yields.</p>
<p>Thus, we should observe a positive relationship between the copper-gold price ratio and 10-year yields. Both should be rising and falling based on the state of the world economy. There’s nothing too crazy here, but it’s an interesting relationship to think about and investigate. That’s what we’ll do today!</p>
<p>First, let’s import the relevant time series data from Quandl. We will specify <code>type = &quot;xts&quot;</code> in order to create xts objects and <code>collapse = &quot;daily&quot;</code> because we want daily prices. Note in particular our data sources: CME for copper and gold, and FRED for the 10-year yield. But, we just need the Quandl codes and to be careful about consistent start/end dates for each data set. It’s a liberating feeling to know before starting a project that we’ll be able to find whatever data we need in one source.</p>
<p>Let’s get to it.</p>
<pre class="r"><code>library(Quandl)
library(dplyr)
library(xts)
library(lubridate)
library(dygraphs)

copper &lt;- Quandl(&quot;CHRIS/CME_HG1&quot;, type = &quot;xts&quot;, collapse = &quot;daily&quot;,  
                    start_date = &quot;2012-01-01&quot;, end_date = &quot;2017-02-28&quot;)

gold &lt;- Quandl(&quot;CHRIS/CME_GC1&quot;, type = &quot;xts&quot;, collapse = &quot;daily&quot;,  
                    start_date = &quot;2012-01-01&quot;, end_date = &quot;2017-02-28&quot;)

ten_year &lt;- Quandl(&quot;FRED/DGS10&quot;, type = &quot;xts&quot;, collapse = &quot;daily&quot;,  
                    start_date = &quot;2012-01-01&quot;, end_date = &quot;2017-02-28&quot;)</code></pre>
<p>Now we want to combine these into one xts object, which normally would be an easy invocation of <code>merge.xts</code>, but there’s a slight wrinkle. After creating one xts object, we know we need to calculate a ratio of copper/gold. That means that the presence of NAs will be a problem (I found this out the old-fashioned way, by running code that threw an error). Let’s take care of that by prepending the <code>na.locf()</code> function to our merge operation. That function will replace all NAs with the previous day’s value. Why might one of our time series have an NA when another doesn’t? Maybe one of the instruments has a trading holiday, or FRED publishes data for days that are general market holidays.</p>
<p>The downside, of course, is that we are adding observed values that are fictional. I can live with that here since we’re creating a visualization to help understand and gain an intuition about the hypothesized copper-gold yield relationship. If we were using this data to create a trading strategy or algorithm, our NA replacement would be unacceptably fuzzy and a more rigorous decision-making process would be needed to synchronize the data sets.</p>
<p>No matter which approach is taken, the most crucial thing is to explain and make easily reproducible whatever process is used for handling NAs or any data cleaning such as this. Your colleagues, future self, clients and research audience can scrutinize, discount, ignore or applaud it accordingly.</p>
<pre class="r"><code># We&#39;re going to merge our 3 xts objects into on xts objects. This would normally be
# very simple with merge.xts but we want to eliminat NAs with na.locf().

copper_gold_tenYear_merged &lt;- na.locf(merge.xts(copper$Settle, gold$Settle, ten_year),
                                      formLast = TRUE)

colnames(copper_gold_tenYear_merged ) &lt;- c(&quot;Copper&quot;, &quot;Gold&quot;, &quot;TenYear&quot;)</code></pre>
<p>Now we create a new column to store the ratio of copper gold prices.</p>
<pre class="r"><code># Create the ratio of prices. I multiply copper by 100 to synch with the scale used by 
# Gundlach in his presentation.
copper_gold_tenYear_merged$ratio &lt;- (copper_gold_tenYear_merged$Copper*100)/copper_gold_tenYear_merged$Gold</code></pre>
<p>We have an xts object that holds four time series, but I want to chart only the copper-gold price ratio and 10-year yields. This next step is not necessary but to be extra clear, I am going to create a new xts object to hold only those two time series.</p>
<pre class="r"><code>tenYear_ratio  &lt;- merge(copper_gold_tenYear_merged$ratio, copper_gold_tenYear_merged$TenYear)</code></pre>
<p>We use dygraphs to chart that one xts object, and call <code>dySeries()</code> for each of the columns to be included.</p>
<pre class="r"><code>dygraph(tenYear_ratio) %&gt;%
  dySeries(&quot;ratio&quot;) %&gt;% 
  dySeries(&quot;TenYear&quot;)</code></pre>
<div id="htmlwidget-f050bba34fad39f004a3" style="width:672px;height:480px;" class="dygraphs html-widget"></div>
<script type="application/json" data-for="htmlwidget-f050bba34fad39f004a3">{"x":{"attrs":{"labels":["day","ratio","TenYear"],"legend":"auto","retainDateWindow":false,"axes":{"x":{"pixelsPerLabel":60}},"series":{"ratio":{"axis":"y"},"TenYear":{"axis":"y"}}},"scale":"daily","annotations":[],"shadings":[],"events":[],"format":"date","data":[["2012-01-03T00:00:00.000Z","2012-01-04T00:00:00.000Z","2012-01-05T00:00:00.000Z","2012-01-06T00:00:00.000Z","2012-01-09T00:00:00.000Z","2012-01-10T00:00:00.000Z","2012-01-11T00:00:00.000Z","2012-01-12T00:00:00.000Z","2012-01-13T00:00:00.000Z","2012-01-17T00:00:00.000Z","2012-01-18T00:00:00.000Z","2012-01-19T00:00:00.000Z","2012-01-20T00:00:00.000Z","2012-01-23T00:00:00.000Z","2012-01-24T00:00:00.000Z","2012-01-25T00:00:00.000Z","2012-01-26T00:00:00.000Z","2012-01-27T00:00:00.000Z","2012-01-30T00:00:00.000Z","2012-01-31T00:00:00.000Z","2012-02-01T00:00:00.000Z","2012-02-02T00:00:00.000Z","2012-02-03T00:00:00.000Z","2012-02-06T00:00:00.000Z","2012-02-07T00:00:00.000Z","2012-02-08T00:00:00.000Z","2012-02-09T00:00:00.000Z","2012-02-10T00:00:00.000Z","2012-02-13T00:00:00.000Z","2012-02-14T00:00:00.000Z","2012-02-15T00:00:00.000Z","2012-02-16T00:00:00.000Z","2012-02-17T00:00:00.000Z","2012-02-21T00:00:00.000Z","2012-02-22T00:00:00.000Z","2012-02-23T00:00:00.000Z","2012-02-24T00:00:00.000Z","2012-02-27T00:00:00.000Z","2012-02-28T00:00:00.000Z","2012-02-29T00:00:00.000Z","2012-03-01T00:00:00.000Z","2012-03-02T00:00:00.000Z","2012-03-05T00:00:00.000Z","2012-03-06T00:00:00.000Z","2012-03-07T00:00:00.000Z","2012-03-08T00:00:00.000Z","2012-03-09T00:00:00.000Z","2012-03-12T00:00:00.000Z","2012-03-13T00:00:00.000Z","2012-03-14T00:00:00.000Z","2012-03-15T00:00:00.000Z","2012-03-16T00:00:00.000Z","2012-03-19T00:00:00.000Z","2012-03-20T00:00:00.000Z","2012-03-21T00:00:00.000Z","2012-03-22T00:00:00.000Z","2012-03-23T00:00:00.000Z","2012-03-26T00:00:00.000Z","2012-03-27T00:00:00.000Z","2012-03-28T00:00:00.000Z","2012-03-29T00:00:00.000Z","2012-03-30T00:00:00.000Z","2012-04-02T00:00:00.000Z","2012-04-03T00:00:00.000Z","2012-04-04T00:00:00.000Z","2012-04-05T00:00:00.000Z","2012-04-06T00:00:00.000Z","2012-04-09T00:00:00.000Z","2012-04-10T00:00:00.000Z","2012-04-11T00:00:00.000Z","2012-04-12T00:00:00.000Z","2012-04-13T00:00:00.000Z","2012-04-16T00:00:00.000Z","2012-04-17T00:00:00.000Z","2012-04-18T00:00:00.000Z","2012-04-19T00:00:00.000Z","2012-04-20T00:00:00.000Z","2012-04-23T00:00:00.000Z","2012-04-24T00:00:00.000Z","2012-04-25T00:00:00.000Z","2012-04-26T00:00:00.000Z","2012-04-27T00:00:00.000Z","2012-04-30T00:00:00.000Z","2012-05-01T00:00:00.000Z","2012-05-02T00:00:00.000Z","2012-05-03T00:00:00.000Z","2012-05-04T00:00:00.000Z","2012-05-07T00:00:00.000Z","2012-05-08T00:00:00.000Z","2012-05-09T00:00:00.000Z","2012-05-10T00:00:00.000Z","2012-05-11T00:00:00.000Z","2012-05-14T00:00:00.000Z","2012-05-15T00:00:00.000Z","2012-05-16T00:00:00.000Z","2012-05-17T00:00:00.000Z","2012-05-18T00:00:00.000Z","2012-05-21T00:00:00.000Z","2012-05-22T00:00:00.000Z","2012-05-23T00:00:00.000Z","2012-05-24T00:00:00.000Z","2012-05-25T00:00:00.000Z","2012-05-29T00:00:00.000Z","2012-05-30T00:00:00.000Z","2012-05-31T00:00:00.000Z","2012-06-01T00:00:00.000Z","2012-06-04T00:00:00.000Z","2012-06-05T00:00:00.000Z","2012-06-06T00:00:00.000Z","2012-06-07T00:00:00.000Z","2012-06-08T00:00:00.000Z","2012-06-11T00:00:00.000Z","2012-06-12T00:00:00.000Z","2012-06-13T00:00:00.000Z","2012-06-14T00:00:00.000Z","2012-06-15T00:00:00.000Z","2012-06-18T00:00:00.000Z","2012-06-19T00:00:00.000Z","2012-06-20T00:00:00.000Z","2012-06-21T00:00:00.000Z","2012-06-22T00:00:00.000Z","2012-06-25T00:00:00.000Z","2012-06-26T00:00:00.000Z","2012-06-27T00:00:00.000Z","2012-06-28T00:00:00.000Z","2012-06-29T00:00:00.000Z","2012-07-02T00:00:00.000Z","2012-07-03T00:00:00.000Z","2012-07-05T00:00:00.000Z","2012-07-06T00:00:00.000Z","2012-07-09T00:00:00.000Z","2012-07-10T00:00:00.000Z","2012-07-11T00:00:00.000Z","2012-07-12T00:00:00.000Z","2012-07-13T00:00:00.000Z","2012-07-16T00:00:00.000Z","2012-07-17T00:00:00.000Z","2012-07-18T00:00:00.000Z","2012-07-19T00:00:00.000Z","2012-07-20T00:00:00.000Z","2012-07-23T00:00:00.000Z","2012-07-24T00:00:00.000Z","2012-07-25T00:00:00.000Z","2012-07-26T00:00:00.000Z","2012-07-27T00:00:00.000Z","2012-07-30T00:00:00.000Z","2012-07-31T00:00:00.000Z","2012-08-01T00:00:00.000Z","2012-08-02T00:00:00.000Z","2012-08-03T00:00:00.000Z","2012-08-06T00:00:00.000Z","2012-08-07T00:00:00.000Z","2012-08-08T00:00:00.000Z","2012-08-09T00:00:00.000Z","2012-08-10T00:00:00.000Z","2012-08-13T00:00:00.000Z","2012-08-14T00:00:00.000Z","2012-08-15T00:00:00.000Z","2012-08-16T00:00:00.000Z","2012-08-17T00:00:00.000Z","2012-08-20T00:00:00.000Z","2012-08-21T00:00:00.000Z","2012-08-22T00:00:00.000Z","2012-08-23T00:00:00.000Z","2012-08-24T00:00:00.000Z","2012-08-27T00:00:00.000Z","2012-08-28T00:00:00.000Z","2012-08-29T00:00:00.000Z","2012-08-30T00:00:00.000Z","2012-08-31T00:00:00.000Z","2012-09-04T00:00:00.000Z","2012-09-05T00:00:00.000Z","2012-09-06T00:00:00.000Z","2012-09-07T00:00:00.000Z","2012-09-10
