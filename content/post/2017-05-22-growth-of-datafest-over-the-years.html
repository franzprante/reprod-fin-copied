---
title: Growth of DataFest over the years
author: 'Mine Çetinkaya-Rundel'
date: '2017-05-24'
slug: growth-of-datafest-over-the-years
categories: [Education, R Language, Shiny]
tags: [R, R Markdown, Shiny, Google Forms]
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet/leaflet.js"></script>
<link href="/rmarkdown-libs/leafletfix/leafletfix.css" rel="stylesheet" />
<link href="/rmarkdown-libs/leaflet-label/leaflet.label.css" rel="stylesheet" />
<script src="/rmarkdown-libs/leaflet-label/leaflet.label.js"></script>
<script src="/rmarkdown-libs/Proj4Leaflet/proj4-compressed.js"></script>
<script src="/rmarkdown-libs/Proj4Leaflet/proj4leaflet.js"></script>
<script src="/rmarkdown-libs/leaflet-binding/leaflet.js"></script>

<p>In <a href="/2017/04/05/datafestorg/">a previous post</a>, I introduced DataFest and how one can streamline the organization of this event using Google Forms and tools from the tidyverse. In this post, I’ll walk through building a Shiny app that demonstrates the growth of DataFest over the years, both in terms of host locations and participating institutions, as well as in terms of the number of students who participated in each event.</p>
<p>Here is a list of all packages used in this article:</p>
<pre class="r"><code>library(tidyverse)
library(googlesheets)
library(devtools)
library(ggmap)
library(stringr)
library(leaflet)</code></pre>
<p>The data were contributed by the event organizers, and were collected using <a href="https://goo.gl/forms/jlLC9B7aVIaF1QoQ2">a Google Form</a>.</p>
<p>To begin, the data are read using the <code>googlesheets</code> package.</p>
<pre class="r"><code>datafest_wide &lt;- gs_title(&quot;DataFest over the years (Responses)&quot;) %&gt;%
  gs_read()</code></pre>
<div id="data-prep" class="section level2">
<h2>Data prep</h2>
<p>Then minimal manipulation is applied to column names, and a new column concatenating city, state, and country is added to be used in geocoding.</p>
<pre class="r"><code># rename columns
yrs &lt;- sort(rep(2011:2017, 3))
cols &lt;- c(&quot;df_&quot;, &quot;num_part_&quot;, &quot;other_inst_&quot;)

names(datafest_wide) &lt;- c(&quot;timestamp&quot;, &quot;host&quot;, &quot;city&quot;, &quot;state&quot;, &quot;country&quot;, &quot;url&quot;,
                     paste0(cols, yrs))

# geocode host location
datafest_wide &lt;- datafest_wide %&gt;%
  mutate(address = paste(city, state, country)) %&gt;% 
  mutate_geocode(address)</code></pre>
<p>Note that we need to use the development version of the <code>ggmap</code> package for <code>mutate_geocode()</code> to play nicely with a <code>tbl_df</code>. You can install this version with <code>install_github(&quot;dkahle/ggmap&quot;)</code>.</p>
<p>Next, we convert the data from wide to long format using functionality from the <code>tidyr</code> package. First, we gather the columns that contain yearly information (for each year, we have an indicator for whether an event was hosted at the location, the number of students that participated, and other participating institutions, if any). Then, we strip the year information from variable names, and instead save it as a variable in the dataset. Finally, we spread the key-value pair across three columns.</p>
<pre class="r"><code>datafest_long &lt;- datafest_wide %&gt;% 
  gather(key, value, df_2011:other_inst_2017) %&gt;%
  mutate(year = as.numeric(str_match(key, &quot;[0-9]+&quot;))) %&gt;%
  mutate(key = str_replace(key, &quot;_[0-9]+&quot;, &quot;&quot;)) %&gt;%
  spread(key, value) %&gt;%
  mutate(num_part = as.numeric(num_part))</code></pre>
</div>
<div id="map-of-2017-asa-datafests" class="section level2">
<h2>Map of 2017 ASA DataFests</h2>
<p>The eventual goal of this post is to make a Shiny app that maps DataFest spread and growth over the years; however, I’ll start by making a map for just one year, 2017, to develop the code for the map, and then use this code within a Shiny app.</p>
<p>Going forward, I’ll refer to the long dataset as <code>datafest</code>.</p>
<pre class="r"><code>datafest &lt;- datafest_long</code></pre>
<p>First, I take a subset of the data for hosts that held an event in 2017:</p>
<pre class="r"><code>datafest_2017 &lt;- filter(datafest, year == 2017 &amp; df == &quot;Yes&quot;)</code></pre>
<p>Then, I set a few colors to be used in the plot,</p>
<pre class="r"><code>href_color &lt;- &quot;#A7C6C6&quot;
marker_color &lt;- &quot;black&quot;
part_color &lt;- &quot;#89548A&quot;</code></pre>
<p>as well as the bounds of the plot based on the min/max longitude/latitude.</p>
<pre class="r"><code>left &lt;- floor(min(datafest$lon))
right &lt;- ceiling(max(datafest$lon))
bottom &lt;- floor(min(datafest$lat))
top &lt;- ceiling(max(datafest$lat))</code></pre>
<p>I will be making the map using the <code>leaflet</code> package, as this package allows for easily overlaying markers and popups to maps. The popups are text bubbles that appear when a point is clicked, and that contain additional information about that data point. This is a good place to add some event-specific information, such as name of host, and link to their event homepage, other participating institutions (if any), and number of participants.</p>
<pre class="r"><code>host_text &lt;- paste0(
  &quot;&lt;b&gt;&lt;a href=&#39;&quot;, datafest_2017$url, &quot;&#39; style=&#39;color:&quot;, 
  href_color, &quot;&#39;&gt;&quot;, datafest_2017$host, &quot;&lt;/a&gt;&lt;/b&gt;&quot;
)

other_inst_text &lt;- paste0(
  ifelse(is.na(datafest_2017$other_inst), 
         &quot;&quot;, 
         paste0(&quot;&lt;br&gt;&quot;, &quot;with participation from &quot;, datafest_2017$other_inst))
)

part_text &lt;- paste0(
  &quot;&lt;font color=&quot;, part_color,&quot;&gt;&quot;, datafest_2017$num_part, 
  &quot; participants&lt;/font&gt;&quot;
)

popups &lt;- paste0(
  host_text, other_inst_text, &quot;&lt;br&gt;&quot;, part_text
)</code></pre>
<p>We’re finally ready to make our map! Note that the radii of the points are proportional to the log of the number of participants (times an arbitrary factor for visual appeal).</p>
<pre class="r"><code>leaflet() %&gt;%
  addTiles() %&gt;%
  fitBounds(lng1 = left, lat1 = bottom, lng2 = right, lat2 = top) %&gt;%
  addCircleMarkers(lng = datafest_2017$lon, lat = datafest_2017$lat,
                   radius = log(datafest_2017$num_part) * 1.2, 
                   fillColor = marker_color,
                   color = marker_color,
                   weight = 1,
                   fillOpacity = 0.5,
                   popup = popups)</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"maxNativeZoom":null,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"continuousWorld":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":null,"unloadInvisibleTiles":null,"updateWhenIdle":null,"detectRetina":false,"reuseTiles":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[[35.9940329,41.6959269,40.4167022,33.7489954,35.4993031,44.0153371,41.5623209,42.9721934,40.7933949,34.0522342,38.9517053,41.49932,39.9611755,33.7879139,37.8715926,39.5069974,42.3732216,35.0853336,40.7127837,49.4874592,37.2295733,38.9071923,41.49932,44.9537029,41.8781136,41.8239891,43.653226],[-78.898619,-73.8968025,-86.8752869,-84.3879824,-80.8486846,-73.16734,-72.6506488,-85.9540407,-77.8600012,-118.2436849,-92.3340724,-81.6943605,-82.9987942,-117.8531007,-122.272747,-84.745231,-72.5198537,-106.6055534,-74.0059413,8.4660395,-80.4139393,-77.0368707,-81.6943605,-93.0899578,-87.6297982,-71.4128343,-79.3831843],[7.06332483774019,5.18098573624357,5.25843196160866,4.56799498772438,4.64544121308947,3.86265098984184,5.18098573624357,3.70925094402998,5.52620422318571,6.84453896958744,3.59487872826479,3.86265098984184,5.6514362415748,5.00926472387476,4.69442760651378,5.39977160439632,5.94699246912151,3.16686879553831,4.56799498772438,5.25843196160866,4.91321347466652,4.8725316126557,3.32710646668774,4.78678085587713,4.42665534493672,4.42665534493672,4.42665534493672],null,null,{"lineCap":null,"lineJoin":null,"clickable":true,"pointerEvents":null,"className":"","stroke":true,"color":"black","weight":1,"opacity":0.5,"fill":true,"fillColor":"black","fillOpacity":0.5,"dashArray":null},null,null,["<b><a href='http://stat.duke.edu/datafest' style='color:#A7C6C6'>Duke University<\/a><\/b><br>with participation from UNC Chapel Hill, NC State, North Carolina A&T, Elon University, NCSSM, Meredith College, Wake Forest University<br><font color=#89548A>360 participants<\/font>","<b><a href='http://pages.vassar.edu/datafest/' style='color:#A7C6C6'>Vassar College<\/a><\/b><br>with participation from Marist College, Colgate University<br><font color=#89548A>75 participants<\/font>","<b><a href='http://llc.stat.purdue.edu/datafest2016.html' style='color:#A7C6C6'>Purdue University<\/a><\/b><br><font color=#89548A>80 participants<\/font>","<b><a href='http://www.quantitative.emory.edu/events/datafest%20.html' style='color:#A7C6C6'>Emory University<\/a><\/b><br><font color=#89548A>45 participants<\/font>","<b><a href='https://www.davidson.edu/academics/mathematics-and-computer-science/student-activities/competitions/datafest' style='color:#A7C6C6'>Davidson College<\/a><\/b><br><font color=#89548A>48 participants<\/font>","<b><a href='http://go.middlebury.edu/datafest' style='color:#A7C6C6'>Middlebury College<\/a><\/b><br><font color=#89548A>25 participants<\/font>","<b><a href='http://datafest.blogs.wesleyan.edu/' style='color:#A7C6C6'>Wesleyan University<\/a><\/b><br>with participation from University of Connecticut, Connecticut College, Trinity College, Yale University, Lafayette College<br><font color=#89548A>75 participants<\/font>","<b><a href='http://www.gvsu.edu/stat/datafest-50.htm' style='color:#A7C6C6'>Grand Valley State University<\/a><\/b><br><font color=#89548A>22 participants<\/font>","<b><a href='http://stat.psu.edu/Events/2016-datafest' style='color:#A7C6C6'>Penn State University<\/a><\/b><br>with participation from PSU Brandywine, PSU Harrisburg, PSU Great Valley, Wilkes University<br><font color=#89548A>100 participants<\/font>","<b><a href='http://datafest.stat.ucla.edu/' style='color:#A7C6C6'>UCLA<\/a><\/b><br>with participation from Pomona, Biola, Cal Poly SLO, UCR<br><font color=#89548A>300 participants<\/font>","<b><a href='NA' style='color:#A7C6C6'>University of Missouri<\/a><\/b><br><font color=#89548A>20 participants<\/font>","<b><a href='https://sites.google.com/view/csudatafest/home' style='color:#A7C6C6'>Cleveland State University<\/a><\/b><br><font color=#89548A>25 participants<\/font>","<b><a href='https://data-analytics.osu.edu/datafest' style='color:#A7C6C6'>Ohio State University<\/a><\/b><br><font color=#89548A>111 participants<\/font>","<b><a href='http://www.chapman.edu/scst/conferences-and-events/datafest.aspx' style='color:#A7C6C6'>Chapman University<\/a><\/b><br>with participation from UCSB, CSUN, USC, CSUF, UCI<br><font color=#89548A>65 participants<\/font>","<b><a href='datafest.stat.berkeley.edu' style='color:#A7C6C6'>UC Berkeley<\/a><\/b><br><font color=#89548A>50 participants<\/font>","<b><a href='http://miamioh.edu/fsb/centers/cads/experiential/datafest/' style='color:#A7C6C6'>Miami University (Ohio)<\/a><\/b><br>with participation from University of Cincinnati; Bowling Green State University<br><font color=#89548A>90 participants<\/font>","<b><a href='http://www.science.smith.edu/datafest/' style='color:#A7C6C6'>University of Massachusets<\/a><\/b><br>with participation from Amherst, Hampshire, Mt. Holyoke, Smith Colleges<br><font color=#89548A>142 participants<\/font>","<b><a href='http://math.unm.edu/news-events/events/asa-datafest' style='color:#A7C6C6'>University of New Mexico<\/a><\/b><br><font color=#89548A>14 participants<\/font>","<b><a href='http://blogs.cuit.columbia.edu/statisticsclub/events/spring-datafest-2017/' style='color:#A7C6C6'>Columbia University<\/a><\/b><br><font color=#89548A>45 participants<\/font>","<b><a href='http://datafest.de/' style='color:#A7C6C6'>University of Mannheim<\/a><\/b><br><font color=#89548A>80 participants<\/font>","<b><a href='http://www.stat.vt.edu/Academics/undergraduate/VTdatafest.html' style='color:#A7C6C6'>Virginia Tech<\/a><\/b><br><font color=#89548A>60 participants<\/font>","<b><a href='https://www.facebook.com/events/520875878090896/' style='color:#A7C6C6'>Summit Consulting, DC<\/a><\/b><br>with participation from George Washington, UMD, UMBC, American, Howard, George Washington<br><font color=#89548A>58 participants<\/font>","<b><a href='http://mathstats.case.edu/datafest-2017/' style='color:#A7C6C6'>Case Western Reserve University<\/a><\/b><br><font color=#89548A>16 participants<\/font>","<b><a href='https://www.macalester.edu/datafest/' style='color:#A7C6C6'>Macalaster College<\/a><\/b><br><font color=#89548A>54 participants<\/font>","<b><a href='http://pascal.math.luc.edu/datafest/' style='color:#A7C6C6'>Loyola University Chicago<\/a><\/b><br><font color=#89548A>40 participants<\/font>","<b><a href='NA' style='color:#A7C6C6'>Brown University<\/a><\/b><br><font color=#89548A>40 participants<\/font>","<b><a href='https://utorontodatafest.wordpress.com/' style='color:#A7C6C6'>University of Toronto<\/a><\/b><br><font color=#89548A>40 participants<\/font>"],null,null,null,null]}],"fitBounds":[33,-123,50,9],"limits":{"lat":[33.7489954,49.4874592],"lng":[-122.272747,8.4660395]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="shiny-app" class="section level2">
<h2>Shiny app</h2>
<p>Next, we build upon our earlier plot to create a Shiny app that has the following three components:</p>
<ol style="list-style-type: decimal">
<li>A slider input with animation for values between 2011 and 2017 (DataFest years, so far)</li>
<li>A line plot that shows the increase in the number participants over the year</li>
<li>A map that shows the spread of DataFest geographically over the years</li>
</ol>
<p>You can find and interact with the app at <a href="https://gallery.shinyapps.io/datafest-map-all-years/" class="uri">https://gallery.shinyapps.io/datafest-map-all-years/</a>, and the code for the app, as well as all steps up to this point, can be found at <a href="https://github.com/mine-cetinkaya-rundel/datafest-growth">this GitHub repo</a>.</p>
<p><a href="https://gallery.shinyapps.io/datafest-map-all-years/"> <img src="/post/2017-05-22-growth-of-datafest-over-the-years_files/app.png" alt="Screenshot of app""> </a></p>
</div>
